Attaching to mailcow-ai-filter
mailcow-ai-filter  | ============================================================
mailcow-ai-filter  | MailCow AI Filter - Email Sorting with AI-Generated Sieve Rules
mailcow-ai-filter  | ============================================================
mailcow-ai-filter  | 
mailcow-ai-filter  | INFO: Logging to file: /app/logs/ai-filter.log
mailcow-ai-filter  | INFO: Starting MailCow AI Filter (Hexagonal Architecture)
mailcow-ai-filter  | Protocol: IMAP
mailcow-ai-filter  | 
mailcow-ai-filter  | INFO: Initialized dependency injection container
mailcow-ai-filter  | INFO: Dependency injection container initialized
mailcow-ai-filter  | INFO: Initialized OllamaEmailSummarizer with worker model gemma2:2b
mailcow-ai-filter  | INFO: Created OllamaEmailSummarizer (worker model: gemma2:2b)
mailcow-ai-filter  | INFO: Loading sentence transformer model: BAAI/bge-large-en-v1.5
mailcow-ai-filter  | INFO: Use pytorch device_name: cpu
mailcow-ai-filter  | INFO: Load pretrained SentenceTransformer: BAAI/bge-large-en-v1.5
mailcow-ai-filter  | INFO: Loaded model BAAI/bge-large-en-v1.5 (embedding_dim=1024)
mailcow-ai-filter  | INFO: Created SentenceTransformerAdapter (model: BAAI/bge-large-en-v1.5)
mailcow-ai-filter  | INFO: Initialized HDBSCAN clustering (min_cluster_size=5, min_samples=2, handle_outliers=True)
mailcow-ai-filter  | INFO: Created HDBSCANClusteringAdapter (min_cluster_size=5, min_samples=2, handle_outliers=True)
mailcow-ai-filter  | INFO: Initialized IMAP adapter for mail.kekz.org
mailcow-ai-filter  | INFO: Created IMAPAdapter instance
mailcow-ai-filter  | INFO: Initialized Ollama adapter with model deepseek-r1:14b (temp=0.7, max_tokens=10000)
mailcow-ai-filter  | INFO: Created OllamaAdapter (master model: deepseek-r1:14b, temp=0.7)
mailcow-ai-filter  | INFO: Initialized Sieve file adapter (output_dir: /app/output)
mailcow-ai-filter  | INFO: Created SieveFileAdapter instance
mailcow-ai-filter  | INFO: Created FilterGenerator instance
mailcow-ai-filter  | INFO: Created AnalyzeEmailsUseCase instance (embedding mode)
mailcow-ai-filter  | INFO: Starting analysis: max_emails=2000, exclude_folders=['Trash', 'Spam', 'Junk', 'Deleted Items']
mailcow-ai-filter  | Fetching and analyzing emails...
mailcow-ai-filter  | 
mailcow-ai-filter  | INFO: Starting email analysis: max_emails=2000, exclude_folders=['Trash', 'Spam', 'Junk', 'Deleted Items']
mailcow-ai-filter  | INFO: Fetching existing folder structure from server...
mailcow-ai-filter  | INFO: Connected to IMAP server mail.kekz.org
mailcow-ai-filter  | INFO: Found 36 folders
mailcow-ai-filter  | INFO: Found 36 existing folders
mailcow-ai-filter  | INFO: Fetching emails from server...
mailcow-ai-filter  | INFO: Fetching emails from folder 'INBOX'...
mailcow-ai-filter  | WARNING: Invalid email address: noreply@qsignal.de (Balu), skipping
mailcow-ai-filter  | WARNING: Invalid email address: noreply@qsignal.de (Balu), skipping
mailcow-ai-filter  | WARNING: Error fetching email b'992': Invalid email address: "Friedmann
mailcow-ai-filter  | WARNING: Error fetching email b'991': Invalid email address: "Friedmann
mailcow-ai-filter  | INFO: Fetched 1568 emails from INBOX
mailcow-ai-filter  | INFO: Fetched 1568 emails
mailcow-ai-filter  | INFO: Using embedding-based clustering mode
mailcow-ai-filter  | INFO: Generating embeddings for 1568 emails...
mailcow-ai-filter  | INFO: Encoding 1568 emails to embeddings...
mailcow-ai-filter  | Batches:   0%|          | 0/49 [00:00<?, ?it/s]Batches:   2%|â–         | 1/49 [00:09<07:33,  9.44s/it]Batches:   4%|â–         | 2/49 [00:19<07:53, 10.07s/it]Batches:   6%|â–Œ         | 3/49 [00:29<07:24,  9.65s/it]Batches:   8%|â–Š         | 4/49 [00:38<07:13,  9.63s/it]Batches:  10%|â–ˆ         | 5/49 [00:47<06:43,  9.16s/it]Batches:  12%|â–ˆâ–        | 6/49 [00:55<06:23,  8.92s/it]Batches:  14%|â–ˆâ–        | 7/49 [01:04<06:16,  8.96s/it]Batches:  16%|â–ˆâ–‹        | 8/49 [01:14<06:16,  9.19s/it]Batches:  18%|â–ˆâ–Š        | 9/49 [01:23<06:04,  9.12s/it]Batches:  20%|â–ˆâ–ˆ        | 10/49 [01:32<05:57,  9.16s/it]Batches:  22%|â–ˆâ–ˆâ–       | 11/49 [01:40<05:38,  8.91s/it]Batches:  24%|â–ˆâ–ˆâ–       | 12/49 [01:49<05:32,  9.00s/it]Batches:  27%|â–ˆâ–ˆâ–‹       | 13/49 [01:57<05:09,  8.58s/it]Batches:  29%|â–ˆâ–ˆâ–Š       | 14/49 [02:05<04:53,  8.39s/it]Batches:  31%|â–ˆâ–ˆâ–ˆ       | 15/49 [02:13<04:39,  8.21s/it]Batches:  33%|â–ˆâ–ˆâ–ˆâ–Ž      | 16/49 [02:25<05:12,  9.47s/it]Batches:  35%|â–ˆâ–ˆâ–ˆâ–      | 17/49 [02:35<05:08,  9.63s/it]Batches:  37%|â–ˆâ–ˆâ–ˆâ–‹      | 18/49 [02:45<05:02,  9.75s/it]Batches:  39%|â–ˆâ–ˆâ–ˆâ–‰      | 19/49 [02:55<04:51,  9.70s/it]Batches:  41%|â–ˆâ–ˆâ–ˆâ–ˆ      | 20/49 [03:08<05:07, 10.60s/it]Batches:  43%|â–ˆâ–ˆâ–ˆâ–ˆâ–Ž     | 21/49 [03:20<05:12, 11.16s/it]Batches:  45%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 22/49 [03:29<04:43, 10.51s/it]Batches:  47%|â–ˆâ–ˆâ–ˆâ–ˆâ–‹     | 23/49 [03:39<04:30, 10.38s/it]Batches:  49%|â–ˆâ–ˆâ–ˆâ–ˆâ–‰     | 24/49 [03:49<04:12, 10.09s/it]Batches:  51%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     | 25/49 [03:58<03:59,  9.98s/it]Batches:  53%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž    | 26/49 [04:09<03:54, 10.19s/it]Batches:  55%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ    | 27/49 [04:19<03:44, 10.21s/it]Batches:  57%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹    | 28/49 [04:29<03:32, 10.14s/it]Batches:  59%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰    | 29/49 [04:37<03:07,  9.38s/it]Batches:  61%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    | 30/49 [04:46<02:59,  9.44s/it]Batches:  63%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž   | 31/49 [04:56<02:50,  9.48s/it]Batches:  65%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ   | 32/49 [05:05<02:40,  9.41s/it]Batches:  67%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹   | 33/49 [05:15<02:33,  9.59s/it]Batches:  69%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰   | 34/49 [05:27<02:33, 10.20s/it]Batches:  71%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–  | 35/49 [05:37<02:20, 10.05s/it]Batches:  73%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž  | 36/49 [05:46<02:09,  9.93s/it]Batches:  76%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ  | 37/49 [05:55<01:56,  9.73s/it]Batches:  78%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š  | 38/49 [06:03<01:41,  9.22s/it]Batches:  80%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰  | 39/49 [06:11<01:28,  8.81s/it]Batches:  82%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– | 40/49 [06:20<01:18,  8.71s/it]Batches:  84%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž | 41/49 [06:25<01:01,  7.67s/it]Batches:  86%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ | 42/49 [06:30<00:48,  6.91s/it]Batches:  88%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š | 43/49 [06:35<00:37,  6.21s/it]Batches:  90%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰ | 44/49 [06:41<00:30,  6.17s/it]Batches:  92%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–| 45/49 [06:43<00:19,  4.96s/it]Batches:  94%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–| 46/49 [06:44<00:11,  3.93s/it]Batches:  96%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ| 47/49 [06:46<00:06,  3.11s/it]Batches:  98%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š| 48/49 [06:47<00:02,  2.45s/it]Batches: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 49/49 [06:47<00:00,  1.96s/it]Batches: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 49/49 [06:47<00:00,  8.32s/it]
mailcow-ai-filter  | INFO: Generated embeddings with shape (1568, 1024)
mailcow-ai-filter  | INFO: Generated embeddings with shape (1568, 1024)
mailcow-ai-filter  | INFO: Clustering emails based on embeddings...
mailcow-ai-filter  | INFO: Clustering 1568 emails...
mailcow-ai-filter  | /usr/local/lib/python3.11/site-packages/sklearn/utils/deprecation.py:132: FutureWarning: 'force_all_finite' was renamed to 'ensure_all_finite' in 1.6 and will be removed in 1.8.
mailcow-ai-filter  |   warnings.warn(
mailcow-ai-filter  | /usr/local/lib/python3.11/site-packages/sklearn/utils/deprecation.py:132: FutureWarning: 'force_all_finite' was renamed to 'ensure_all_finite' in 1.6 and will be removed in 1.8.
mailcow-ai-filter  |   warnings.warn(
mailcow-ai-filter  | INFO: Found 95 clusters, 569 outliers (outlier rate: 36.3%)
mailcow-ai-filter  | INFO: Re-clustering 569 outliers with lower thresholds...
mailcow-ai-filter  | /usr/local/lib/python3.11/site-packages/sklearn/utils/deprecation.py:132: FutureWarning: 'force_all_finite' was renamed to 'ensure_all_finite' in 1.6 and will be removed in 1.8.
mailcow-ai-filter  |   warnings.warn(
mailcow-ai-filter  | /usr/local/lib/python3.11/site-packages/sklearn/utils/deprecation.py:132: FutureWarning: 'force_all_finite' was renamed to 'ensure_all_finite' in 1.6 and will be removed in 1.8.
mailcow-ai-filter  |   warnings.warn(
mailcow-ai-filter  | INFO: Re-clustering created 83 additional clusters from 341 outliers
mailcow-ai-filter  | INFO: Found 178 clusters
mailcow-ai-filter  | INFO: Labeling clusters with master model...
mailcow-ai-filter  | INFO: Analyzing 178 email clusters with master model (deepseek-r1:14b)...
mailcow-ai-filter  | INFO: Calling Ollama with model deepseek-r1:14b...
mailcow-ai-filter  | INFO: Master model identified 1 categories
mailcow-ai-filter  | INFO: Generating Sieve filter from patterns...
mailcow-ai-filter  | INFO: Generated filter with 22 rules
mailcow-ai-filter  | INFO: Disconnected from IMAP server
mailcow-ai-filter  | INFO: Email analysis completed in 519.62s
mailcow-ai-filter  | INFO: Saved Sieve filter to /app/output/generated.sieve
mailcow-ai-filter  | INFO: Generated 22 rules
mailcow-ai-filter  | 
mailcow-ai-filter  | ============================================================
mailcow-ai-filter  | Analysis Complete!
mailcow-ai-filter  | ============================================================
mailcow-ai-filter  | 
mailcow-ai-filter  | Analyzed: 1568 emails
mailcow-ai-filter  | Identified: 22 categories
mailcow-ai-filter  | Generated: /app/output/generated.sieve
mailcow-ai-filter  | Time: 519.60s
mailcow-ai-filter  | 
mailcow-ai-filter  | Next steps:
mailcow-ai-filter  | 1. Review the generated rules in /app/output/generated.sieve
mailcow-ai-filter  | 2. Test with a small subset of emails
mailcow-ai-filter  | 3. Upload to MailCow: Mailbox â†’ Edit â†’ Sieve filters
mailcow-ai-filter  | 
mailcow-ai-filter  | INFO: MailCow AI Filter completed successfully
[Kmailcow-ai-filter exited with code 0
